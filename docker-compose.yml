# macOS in Docker for local testing (using dockur/macos)
#
# Usage:
#   docker-compose up -d        # Start macOS container
#   open http://localhost:8006  # Web UI for installation/access
#   docker-compose down         # Stop container
#
# First run:
#   1. Open http://localhost:8006
#   2. Use Disk Utility to format the virtual disk
#   3. Install macOS (takes 15-30 min)
#   4. After setup, enable SSH: System Preferences > Sharing > Remote Login
#
# Requirements:
#   - Linux with KVM support (/dev/kvm)
#   - 50GB+ free disk space
#   - 8GB+ RAM recommended
#

services:
  macos:
    image: dockurr/macos
    container_name: php-packages-macos
    environment:
      VERSION: "15"      # macOS version: 11, 12, 13, 14, 15
      DISK_SIZE: "64G"   # Virtual disk size
      RAM_SIZE: "8G"     # RAM allocation
      CPU_CORES: "4"     # CPU cores
    devices:
      - /dev/kvm
      - /dev/net/tun
    cap_add:
      - NET_ADMIN
    ports:
      - "8006:8006"      # Web UI
      - "5900:5900"      # VNC
      - "10022:22"       # SSH (after enabling in macOS)
    volumes:
      - macos-storage:/storage
      - .:/mnt/php-packages:cached
    restart: unless-stopped
    stop_grace_period: 2m

volumes:
  macos-storage:
    driver: local
